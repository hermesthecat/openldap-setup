Alma Linux 8 OpenLDAP Client Kurulumu

OS: Alma Linux 8.6
ip: 192.168.205.4
hostname: ldapclient.hermes.local
domain: hermes.local
tüm şifreler: azadazad
azadazad SSHA'lı hali: {SSHA}2jEeYRSHerfUNztuwVDHnQtDSKrMKrXz
test kullanıcıları: kerem ve abdullah

    CN – Common Name
    O – Organizational
    OU – Organizational Unit
    SN – Last Name
    DC – Domain Component(DC often comes with two entries dc=example,dc=com)
    DN – Distinguished Name

güncellemelerden önce key güncelleme:
rpm --import https://repo.almalinux.org/almalinux/RPM-GPG-KEY-AlmaLinux

temel paketleri yükleme: 
yum install nano wget -y

tüm güncellemeleri yapalım:
sudo dnf update -y

reboot gerekirse yapılsın:
[ -f /var/run/reboot-required ] && sudo reboot -f

hostname'i ayarlayalım:
sudo hostnamectl set-hostname ldapclient.hermes.local

hosts dosyasını güncelleyelim:
sudo echo "192.168.205.3 ldapmaster.hermes.local" >> /etc/hosts
sudo echo "192.168.205.4 ldapclient.hermes.local" >> /etc/hosts

cat /etc/hosts

paketlerin kurulumu:
sudo dnf install openldap-clients sssd sssd-ldap oddjob-mkhomedir libsss_sudo -y

harbiden kuruldu mu:
rpm -qa | grep ldap

authselect listesini bi görelim:
authselect list

authselect'i SSSD'ye çevirelim:
sudo authselect select sssd with-mkhomedir --force

oddjobd servisi yeniden başlatalım:
sudo systemctl enable --now oddjobd.service

servis çalışıyor mu:
systemctl status oddjobd.service

openldap client'î yapilandiralim:
sudo nano /etc/openldap/ldap.conf

URI ldap://ldapmaster.hermes.local
BASE dc=hermes,dc=local
SUDOERS_BASE ou=sudo,dc=hermes,dc=local

dosyayı kaydet.

sssd'yi yapılandıralım:
sudo nano /etc/sssd/sssd.conf

[domain/default]
id_provider = ldap
autofs_provider = ldap
auth_provider = ldap
chpass_provider = ldap
ldap_uri = ldap://ldapmaster.hermes.local
ldap_search_base = dc=hermes,dc=local
sudoers_base ou=sudo,dc=hermes,dc=local
sudo_provider = ldap
ldap_id_use_start_tls = True
ldap_tls_cacertdir = /etc/openldap/certs
cache_credentials = True
ldap_tls_reqcert = allow

[sssd]
services = nss, pam, autofs, sudo
domains = default

[nss]
homedir_substring = /home

[sudo]

dosyayı kaydet.

eizinleri ayarla:
sudo chmod 0600 /etc/sssd/sssd.conf

sssd yeniden başlat:
sudo systemctl restart sssd

servis çalışıyor mu:
systemctl status sssd

kerem kullanıcını görüntülemeyi deneyelim:
ldapsearch -x -b "uid=kerem,ou=people,dc=hermes,dc=local"

kerem kullanıcının bilgilerini görüyorsanız, client başarılı bir şekilde server'a bağlanıyor demektir.

oturum açmayi deniyelim:
ssh kerem@192.168.205.4

ldap şifresi azadazad girin enter'layin.

bende oturum açtı :)

==== ŞİMDİ LDAP KULLANICILARINA SUDO YETKİSİ VERME ====

nsswitch dosyasını düzenleyelim:
sudo nano /etc/nsswitch.conf

sudoers: files sss
yukardaki satırı ekle dosyayı kaydet.

servisi yeniden başlat.
sudo systemctl restart sssd

kerem kullanıcısına bağlıyken sudo -i yaz. şifre gir.

BU KADAR :)